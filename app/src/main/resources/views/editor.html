<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<!-- Layout -->
<div th:fragment="editor" th:remove="tag">

    <!-- Script Execution -->
    <div class="lg:col-span-2 space-y-6">

        <!-- Script Management -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <!--<div class="bg-white rounded-lg shadow-lg p-6 mb-6">-->
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-4">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <!--<i class="fas fa-code mr-2"></i>Script Editor-->
                    <svg class="mr-2" fill="currentColor" height="24" viewBox="0 0 24 24" width="24">
                        <path d="M9.4 16.6L4.8 12L9.4 7.4L8 6L2 12L8 18L9.4 16.6ZM14.6 16.6L19.2 12L14.6 7.4L16 6L22 12L16 18L14.6 16.6Z"/>
                    </svg>
                    Script Management
                    <span class="ml-4 text-purple-200 text-sm" x-show="selectedSession">
                    Working with: <span x-text="selectedSession"></span>
                </span>
                </h2>
            </div>
            <div class="p-6">
                <!--<h2 class="text-xl font-semibold mb-4">
                    <svg class="mr-2" fill="currentColor" height="24" viewBox="0 0 24 24" width="24">
                        <path d="M9.4 16.6L4.8 12L9.4 7.4L8 6L2 12L8 18L9.4 16.6ZM14.6 16.6L19.2 12L14.6 7.4L16 6L22 12L16 18L14.6 16.6Z"/>
                    </svg>Script Management
                    <span class="ml-4 text-purple-200 text-sm" x-show="selectedSession">
                        Working with: <span x-text="selectedSession"></span>
                    </span>
                </h2>-->
                <div class="flex gap-4 mb-4">
                    <input class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" placeholder="Script name..."
                           x-model="scriptName">
                    <button :disabled="!scriptName || !script.code" @click="saveScript()"
                            class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50">
                        Save Script
                    </button>
                    <button :disabled="!selectedSavedScript" @click="loadScript()"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50">
                        Load Script
                    </button>
                    <button :disabled="!selectedSavedScript" @click="deleteScript()"
                            class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:opacity-50">
                        Delete Script
                    </button>
                </div>
                <div class="flex gap-4">
                    <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" x-model="selectedSavedScript">
                        <option value="">Select saved script...</option>
                        <template :key="savedScript.id" x-for="savedScript in savedScripts">
                            <option :value="savedScript.id" x-text="savedScript.name"></option>
                        </template>
                    </select>
                    <input @input="filterScripts()" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" placeholder="Search scripts..."
                           x-model="searchQuery">
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="flex border-b bg-gradient-to-r from-blue-500 to-purple-700">
                <button :class="activeEditorTab === 'script' ? 'bg-blue-400 text-white border-white' : 'bg-transparent text-blue-100 hover:text-gray-700 hover:bg-white border-transparent'"
                        @click="changeValue('activeEditorTab', 'script')"
                        class="px-6 py-3 font-medium transition-colors duration-100 border-b-4">
                    Script Editor
                </button>
                <button :class="activeEditorTab === 'ui-config' ? 'bg-blue-450 text-white border-white' : 'bg-transparent text-blue-100 hover:text-gray-700 hover:bg-white border-transparent'"
                        @click="changeValue('activeEditorTab', 'ui-config')"
                        class="px-6 py-3 font-medium transition-colors duration-100 border-b-4">
                    UI Configuration
                </button>
                <button :class="activeEditorTab === 'ui-execute' ? 'bg-blue-500 text-white border-white' : 'bg-transparent text-blue-100 hover:text-gray-700 hover:bg-white border-transparent'"
                        @click="changeValue('activeEditorTab', 'ui-execute')"
                        class="px-6 py-3 font-medium transition-colors duration-100 border-b-4">
                    UI Execution
                </button>
            </div>

            <!-- Tab Content -->
            <div class="p-6">
                <!-- Script Editor Tab -->
                <div x-cloak x-show="activeEditorTab === 'script'">

                    <!-- Script Editor Card -->
                    <div th:remove="tag" th:replace="~{tab-script::tab}">
                        <p>
                            Here placed content of views/tab-script.html, tag `th:fragment="tab"`
                        </p>
                    </div>
                    <!--
                    <form @submit.prevent="executeScript()" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Groovy Script</label>
                            <textarea class="code-editor w-full h-64 px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
                                      placeholder="// Enter your Groovy script here...&#10;driver.get('https://example.com')&#10;return [title: driver.getTitle()]"
                                      x-model="script.code"></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Execution Timeout (seconds)</label>
                                <input class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                       max="3600" min="1" type="number" x-model="script.timeout">
                            </div>
                            <div class="flex items-end">
                                <button :disabled="!selectedSession || loading.executeScript"
                                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 text-white font-semibold py-3 px-4 rounded-lg transition-all transform hover:scale-105"
                                        type="submit">
                                    <span x-show="!loading.executeScript">Execute Script</span>
                                    <span x-cloak x-show="loading.executeScript">Executing...</span>
                                </button>
                            </div>
                        </div>
                    </form>
                    -->
                </div>

                <!-- UI Configuration Tab -->
                <div x-cloak x-show="activeEditorTab === 'ui-config'">
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-200">
                            <h3 class="text-lg font-semibold mb-3 text-blue-800">Quick UI Examples</h3>
                            <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                <button @click="loadExample('login')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Login Form
                                </button>
                                <button @click="loadExample('search')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Search Interface
                                </button>
                                <button @click="loadExample('form')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Contact Form
                                </button>
                                <button @click="loadExample('data')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Data Entry
                                </button>
                                <button @click="loadExample('settings')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Settings Panel
                                </button>
                                <button @click="loadExample('filters')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Filter Options
                                </button>
                                <button @click="loadExample('wizard')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Wizard Steps
                                </button>
                                <button @click="loadExample('dashboard')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Dashboard Controls
                                </button>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                <button @click="loadExample('ecommerce')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    E-commerce
                                </button>
                                <button @click="loadExample('profile')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    User Profile
                                </button>
                                <button @click="loadExample('admin')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Admin Panel
                                </button>
                                <button @click="loadExample('feedback')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Feedback Form
                                </button>
                                <button @click="loadExample('booking')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Booking Form
                                </button>
                                <button @click="loadExample('survey')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Survey Form
                                </button>
                                <button @click="loadExample('calculator')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Calculator UI
                                </button>
                                <button @click="loadExample('translation')"
                                        class="px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-600 transition-colors">
                                    Translation
                                </button>
                            </div>
                        </div>

                        <!-- Element Type Examples -->
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <h3 class="text-lg font-semibold mb-3 text-gray-800">Element Types</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                <button @click="addElementExample('input')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Text Input
                                </button>
                                <button @click="addElementExample('textarea')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Textarea
                                </button>
                                <button @click="addElementExample('select')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Select Dropdown
                                </button>
                                <button @click="addElementExample('checkbox')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Checkbox
                                </button>
                                <button @click="addElementExample('radio')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Radio Group
                                </button>
                                <button @click="addElementExample('number')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Number Input
                                </button>
                                <button @click="addElementExample('date')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Date Input
                                </button>
                                <button @click="addElementExample('display')"
                                        class="px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    Display Field
                                </button>
                            </div>
                        </div>

                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">UI Configuration JSON</h3>
                        </div>
                        <textarea
                                :placeholder="uiPlaceholder"
                                @input.debounce.300ms="backupValue('uiConfig', uiConfig); validateUIConfig(); tryParseUIConfig()"
                                class="code-editor w-full h-96 px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
                                placeholder="Paste json here"
                                x-model="uiConfig"></textarea>

                        <div class="grid grid-cols-2 gap-4">
                            <button @click="validateUIConfig()"
                                    class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                Validate JSON
                            </button>
                            <button @click="previewUI()"
                                    class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                                Preview UI
                            </button>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-4" x-cloak x-show="uiConfigValid">
                            <p class="text-green-800">✓ UI Configuration is valid</p>
                        </div>
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4" x-cloak x-show="uiConfigError">
                            <p class="text-red-800">✗ Error: <span x-text="uiConfigError"></span></p>
                        </div>
                    </div>
                </div>

                <!-- UI Execution Tab -->
                <div x-cloak x-show="activeEditorTab === 'ui-execute'">
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold">Dynamic UI Execution</h3>

                        <!-- Dynamic UI Elements -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <template x-if="parsedUIConfig.length > 0">
                                <div class="space-y-4">
                                    <template :key="element.name" x-for="element in parsedUIConfig">
                                        <div x-ui-element="element"></div>
                                    </template>
                                </div>
                            </template>
                            <template x-if="parsedUIConfig.length === 0">
                                <p class="text-gray-600 text-center py-8">No UI elements configured. Configure them in
                                    the UI Configuration tab.</p>
                            </template>
                        </div>

                        <!-- Execution Controls -->
                        <div class="flex gap-4" x-show="selectedSession">
                            <button :disabled="!selectedSession || loading.executeScript"
                                    @click="executeScript()"
                                    class="px-6 py-3 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 disabled:opacity-50 text-white font-semibold rounded-lg transition-all transform hover:scale-105">
                                <span x-show="!loading.executeScript">Execute with UI Data</span>
                                <span x-cloak x-show="loading.executeScript">Executing...</span>
                            </button>
                            <button @click="clearUIData()"
                                    class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                                Clear UI Data
                            </button>
                        </div>

                        <!-- UI Data Preview -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4" x-cloak
                             x-show="Object.keys(uiData).length > 0">
                            <h4 class="font-semibold mb-2">Current UI Data:</h4>
                            <pre class="text-sm text-gray-700" x-text="JSON.stringify(uiData, null, 2)"></pre>
                        </div>
                        <div class="bg-grey-50 border border-gray-200 rounded-lg p-4 relative" x-cloak
                             x-show="selectedSession">
                            <button @click="navigator.clipboard.writeText(curlExample).then(() => { $el.textContent = 'Copied!'; setTimeout(() => $el.textContent = 'Copy', 1000); })"
                                    class="absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition-colors">
                                Copy
                            </button>
                            <pre class="text-sm text-gray-700 truncate" x-text="curlExample"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Execution Results Card -->
        <div th:remove="tag" th:replace="~{execution-result::card}">
            <p>
                Here placed content of views/execution-result.html, tag `th:fragment="card"`
            </p>
        </div>

        <!-- Bottom Panel: Help text -->
        <div th:remove="tag" th:replace="~{help-text::help-text}">
            <p>
                Here placed content of views/help-text.html, tag `th:fragment="help-text"`
            </p>
        </div>

    </div>
</div>
</body>
</html>