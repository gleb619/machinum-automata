<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<!-- Layout -->
<div th:fragment="editor" th:remove="tag">

    <!-- Script Execution -->
    <div class="lg:col-span-2 space-y-6">

        <!-- Script Management -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-4">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <svg class="mr-2" fill="none" height="24" viewBox="0 0 24 24" width="24">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <g clip-path="url(#clip0_429_10996)">
                                <path d="M8 19.0004C8.83566 19.6281 9.87439 20 11 20C13.7614 20 16 17.7614 16 15C16 12.2386 13.7614 10 11 10L16 4H8"
                                      stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2.5"></path>
                            </g>
                            <defs>
                                <clipPath id="clip0_429_10996">
                                    <rect fill="white" height="24" width="24"></rect>
                                </clipPath>
                            </defs>
                        </g>
                    </svg>
                    Script Management
                    <span class="ml-4 text-purple-200 text-sm" x-cloak x-show="selectedSession">
                        <span x-text="`Working with: [${selectedSession}]`"></span>
                    </span>
                </h2>
            </div>

            <!-- Create Mode -->
            <div class="max-w-lg mx-auto p-6" x-cloak x-show="headerMode === 'create'">
                <h3 class="font-semibold text-gray-700 mb-4 text-center">Create New Script</h3>
                <div class="space-y-4">
                    <input @keyup.enter="saveScript(scriptName)"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center"
                           placeholder="Enter script name"
                           type="text"
                           x-model="scriptName">
                    <div class="flex gap-3">
                        <button :disabled="!scriptName.trim()"
                                @click="saveScript(scriptName)"
                                class="flex-1 bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                            Save Script
                        </button>
                        <button @click="headerMode = 'list'"
                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>

            <!-- List Mode -->
            <div class="p-4 grid grid-cols-1" x-cloak x-show="headerMode === 'list'">
                <div class="md:col-span-2">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-semibold text-gray-700 mb-3">Scripts</h3>
                        <button :class="headerMode === 'create' ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                @click="headerMode = 'create'"
                                class="px-4 py-2 rounded-md font-medium transition-colors">
                            Create New Script
                        </button>
                    </div>
                    <div class="mb-4 relative">
                        <input @input="filterScripts" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" placeholder="Filter scripts..." type="text"
                               x-model="searchQuery">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg fill="none" height="24" viewBox="0 0 24 24" width="24">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z"
                                          stroke="#000000" stroke-linecap="round" stroke-linejoin="round"
                                          stroke-width="2"></path>
                                </g>
                            </svg>
                        </div>
                    </div>

                    <div class="border rounded-lg overflow-hidden">
                        <ul class="divide-y divide-gray-200 max-h-128 overflow-y-auto">
                            <template x-if="filteredScripts.length === 0">
                                <li class="px-4 py-8 text-center text-gray-500">No scripts found.</li>
                            </template>

                            <template :key="script.id" x-for="script in filteredScripts">
                                <li class="px-4 py-3 flex justify-between items-center hover:bg-gray-50 transition-colors">
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-800" x-text="script.name"></span>
                                        <span class="text-xs text-gray-500" x-text="`ID: ${script.id}`"></span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <button @click="loadScript(script.id)" class="text-indigo-400 hover:text-indigo-600"
                                                title="Load Script">
                                            <svg fill="currentColor" height="24" viewBox="0 0 24 24" width="24">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round"
                                                   stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path clip-rule="evenodd" d="M3 14.25C3.41421 14.25 3.75 14.5858 3.75 15C3.75 16.4354 3.75159 17.4365 3.85315 18.1919C3.9518 18.9257 4.13225 19.3142 4.40901 19.591C4.68577 19.8678 5.07435 20.0482 5.80812 20.1469C6.56347 20.2484 7.56459 20.25 9 20.25H15C16.4354 20.25 17.4365 20.2484 18.1919 20.1469C18.9257 20.0482 19.3142 19.8678 19.591 19.591C19.8678 19.3142 20.0482 18.9257 20.1469 18.1919C20.2484 17.4365 20.25 16.4354 20.25 15C20.25 14.5858 20.5858 14.25 21 14.25C21.4142 14.25 21.75 14.5858 21.75 15V15.0549C21.75 16.4225 21.75 17.5248 21.6335 18.3918C21.5125 19.2919 21.2536 20.0497 20.6517 20.6516C20.0497 21.2536 19.2919 21.5125 18.3918 21.6335C17.5248 21.75 16.4225 21.75 15.0549 21.75H8.94513C7.57754 21.75 6.47522 21.75 5.60825 21.6335C4.70814 21.5125 3.95027 21.2536 3.34835 20.6517C2.74643 20.0497 2.48754 19.2919 2.36652 18.3918C2.24996 17.5248 2.24998 16.4225 2.25 15.0549C2.25 15.0366 2.25 15.0183 2.25 15C2.25 14.5858 2.58579 14.25 3 14.25Z" fill-rule="evenodd"
                                                          opacity="0.5"></path>
                                                    <path clip-rule="evenodd" d="M12 16.75C12.2106 16.75 12.4114 16.6615 12.5535 16.5061L16.5535 12.1311C16.833 11.8254 16.8118 11.351 16.5061 11.0715C16.2004 10.792 15.726 10.8132 15.4465 11.1189L12.75 14.0682V3C12.75 2.58579 12.4142 2.25 12 2.25C11.5858 2.25 11.25 2.58579 11.25 3V14.0682L8.55353 11.1189C8.27403 10.8132 7.79963 10.792 7.49393 11.0715C7.18823 11.351 7.16698 11.8254 7.44648 12.1311L11.4465 16.5061C11.5886 16.6615 11.7894 16.75 12 16.75Z"
                                                          fill-rule="evenodd"></path>
                                                </g>
                                            </svg>
                                        </button>
                                        <button @click="deleteScript(script.id)" class="text-white hover:text-red-600"
                                                title="Delete Script">
                                            <svg fill="currentColor" height="24" viewBox="0 0 24 24" width="24">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round"
                                                   stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path d="M18 6L17.1991 18.0129C17.129 19.065 17.0939 19.5911 16.8667 19.99C16.6666 20.3412 16.3648 20.6235 16.0011 20.7998C15.588 21 15.0607 21 14.0062 21H9.99377C8.93927 21 8.41202 21 7.99889 20.7998C7.63517 20.6235 7.33339 20.3412 7.13332 19.99C6.90607 19.5911 6.871 19.065 6.80086 18.0129L6 6M4 6H20M16 6L15.7294 5.18807C15.4671 4.40125 15.3359 4.00784 15.0927 3.71698C14.8779 3.46013 14.6021 3.26132 14.2905 3.13878C13.9376 3 13.523 3 12.6936 3H11.3064C10.477 3 10.0624 3 9.70951 3.13878C9.39792 3.26132 9.12208 3.46013 8.90729 3.71698C8.66405 4.00784 8.53292 4.40125 8.27064 5.18807L8 6"
                                                          stroke="#ed2424" stroke-linecap="round" stroke-linejoin="round"
                                                          stroke-width="2"></path>
                                                </g>
                                            </svg>
                                        </button>
                                    </div>
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="flex border-b bg-gradient-to-r from-blue-500 to-purple-700" x-cloak x-show="script?.id">
                <button :class="activeEditorTab === 'script' ? 'bg-blue-400 text-white border-white' : 'bg-transparent text-blue-100 hover:text-gray-700 hover:bg-white border-transparent'"
                        @click="changeValue('activeEditorTab', 'script')"
                        class="px-6 py-3 font-medium transition-colors duration-100 border-b-4">
                    3.1 Script Editor
                </button>
                <button :class="activeEditorTab === 'ui-config' ? 'bg-blue-450 text-white border-white' : 'bg-transparent text-blue-100 hover:text-gray-700 hover:bg-white border-transparent'"
                        @click="changeValue('activeEditorTab', 'ui-config')"
                        class="px-6 py-3 font-medium transition-colors duration-100 border-b-4">
                    3.2 UI Configuration
                </button>
                <button :class="activeEditorTab === 'ui-execute' ? 'bg-blue-500 text-white border-white' : 'bg-transparent text-blue-100 hover:text-gray-700 hover:bg-white border-transparent'"
                        @click="changeValue('activeEditorTab', 'ui-execute')"
                        class="px-6 py-3 font-medium transition-colors duration-100 border-b-4">
                    3.3 UI Execution
                </button>
                <button :class="activeEditorTab === 'results' ? 'bg-blue-500 text-white border-white' : 'bg-transparent text-blue-100 hover:text-gray-700 hover:bg-white border-transparent'"
                        @click="changeValue('activeEditorTab', 'results')"
                        class="px-6 py-3 font-medium transition-colors duration-100 border-b-4">
                    3.4 Results
                </button>
            </div>

            <!-- Tab Content -->
            <template x-if="script?.id">
            <div class="p-6">
                <!-- Script Editor Tab -->
                <div x-cloak x-show="activeEditorTab === 'script'">
                    <!-- Script Editor Card -->
                    <div th:remove="tag" th:replace="~{tab-script::tab}">
                        <p>
                            Here placed content of views/tab-script.html, tag `th:fragment="tab"`
                        </p>
                    </div>
                </div>

                <!-- UI Configuration Tab -->
                <div x-cloak x-show="activeEditorTab === 'ui-config'">
                    <!-- UI Config Card -->
                    <div th:remove="tag" th:replace="~{tab-ui-config::tab}">
                        <p>
                            Here placed content of views/tab-ui-config.html, tag `th:fragment="tab"`
                        </p>
                    </div>
                </div>

                <!-- UI Execution Tab -->
                <div x-cloak x-show="activeEditorTab === 'ui-execute'">
                    <!-- UI Execution Card -->
                    <div th:remove="tag" th:replace="~{tab-ui-execution::tab}">
                        <p>
                            Here placed content of views/tab-execution.html, tag `th:fragment="tab"`
                        </p>
                    </div>
                </div>

                <div x-cloak x-show="activeEditorTab === 'results'">
                    <!-- Serverside Results Card -->
                    <div th:remove="tag" th:replace="~{tab-result::tab}">
                        <p>
                            Here placed content of views/tab-result.html, tag `th:fragment="tab"`
                        </p>
                    </div>
                </div>
            </div>
            </template>
        </div>

        <!-- Execution Results Card -->
        <div th:remove="tag" th:replace="~{execution-result::card}">
            <p>
                Here placed content of views/execution-result.html, tag `th:fragment="card"`
            </p>
        </div>

        <!-- Bottom Panel: Help text -->
        <div th:remove="tag" th:replace="~{help-text::help-text}">
            <p>
                Here placed content of views/help-text.html, tag `th:fragment="help-text"`
            </p>
        </div>

    </div>
</div>
</body>
</html>